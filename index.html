<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Allens List</title>
<style>
:root{
  /* base (fallback) */
  --bg:#050708;
  --panel:#0a0f0b;
  --panel-2:#0f1611;
  --accent:#00ff9c;
  --accent-2:#33ffb7;
  --text:#d7ffe7;
  --muted:#72f7c6;
  --line:#10331f;
  --danger:#ff3b3b;
  --font-body: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
}

/* ===== THEMES (20) ===== */
/* 1. Midnight Glass (default) */
body[data-theme="midnight-glass"]{
  --bg:#0b1220; --panel:rgba(255,255,255,0.06); --panel-2:rgba(255,255,255,0.08);
  --accent:#60a5fa; --accent-2:#93c5fd; --text:#e7efff; --muted:#9db3d9; --line:rgba(148,163,184,0.25);
  --danger:#f87171; --font-body: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "SF Pro Text", Arial;
}
/* 2. Clean Pro */
body[data-theme="clean-pro"]{
  --bg:#0b0e11; --panel:#0f1419; --panel-2:#121922;
  --accent:#22d3ee; --accent-2:#67e8f9; --text:#e6f7ff; --muted:#9ad1de; --line:#1b2632;
  --danger:#f97373; --font-body: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
}
/* 3. Ivory Gold Luxe */
body[data-theme="ivory-gold-luxe"]{
  --bg:#0e0e0c; --panel:rgba(255,255,240,0.06); --panel-2:rgba(255,255,240,0.1);
  --accent:#f5d483; --accent-2:#ffe49b; --text:#fff8e7; --muted:#e6d6b3; --line:rgba(245,212,131,0.25);
  --danger:#ff8b73; --font-body: "SF Pro Text", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
}
/* 4. Carbon Neon */
body[data-theme="carbon-neon"]{
  --bg:#0a0a0a; --panel:#121212; --panel-2:#171717;
  --accent:#22ff88; --accent-2:#55ff9f; --text:#d9fbe7; --muted:#9bf2c3; --line:#1e3626;
  --danger:#ff5a5a; --font-body: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}
/* 5. Deep Purple */
body[data-theme="deep-purple"]{
  --bg:#0d0716; --panel:#150d22; --panel-2:#1b1230;
  --accent:#a78bfa; --accent-2:#c4b5fd; --text:#efe9ff; --muted:#b9a9f3; --line:#2a1c46;
  --danger:#ff6b6b; --font-body: "Inter", ui-sans-serif, system-ui, -apple-system;
}
/* 6. Forest Emerald */
body[data-theme="forest-emerald"]{
  --bg:#071410; --panel:#0b1a15; --panel-2:#0f241d;
  --accent:#10b981; --accent-2:#34d399; --text:#dbfff0; --muted:#94dbc0; --line:#173a2e;
  --danger:#f87171; --font-body: "Inter", ui-sans-serif, system-ui;
}
/* 7. Rose Quartz */
body[data-theme="rose-quartz"]{
  --bg:#140d11; --panel:#1b1318; --panel-2:#251820;
  --accent:#fb7185; --accent-2:#fda4af; --text:#ffe6eb; --muted:#f2b9c1; --line:#3a1f2a;
  --danger:#ff9393; --font-body: "Inter", ui-sans-serif, system-ui;
}
/* 8. Sunset Gold */
body[data-theme="sunset-gold"]{
  --bg:#120e09; --panel:#1a140d; --panel-2:#21190f;
  --accent:#f59e0b; --accent-2:#fbbf24; --text:#fff2d9; --muted:#e9c89a; --line:#3a2a11;
  --danger:#ff7a7a; --font-body: "Inter", ui-sans-serif;
}
/* 9. Ocean Breeze */
body[data-theme="ocean-breeze"]{
  --bg:#07131a; --panel:#0a1a24; --panel-2:#0e2430;
  --accent:#38bdf8; --accent-2:#7dd3fc; --text:#e6f7ff; --muted:#a7d7f3; --line:#103245;
  --danger:#ff6b6b; --font-body: "Inter", ui-sans-serif, system-ui;
}
/* 10. Matte Black */
body[data-theme="matte-black"]{
  --bg:#0a0b0c; --panel:#0f1012; --panel-2:#131417;
  --accent:#9ca3af; --accent-2:#c7cbd1; --text:#e5e7eb; --muted:#aeb3bb; --line:#1c1e22;
  --danger:#ef4444; --font-body: "SF Pro Text", ui-sans-serif, system-ui;
}
/* 11. Slate Gray */
body[data-theme="slate-gray"]{
  --bg:#0c0f12; --panel:#12161a; --panel-2:#171c21;
  --accent:#94a3b8; --accent-2:#cbd5e1; --text:#e2e8f0; --muted:#a8b0bd; --line:#1f2831;
  --danger:#f87171; --font-body: "Inter", ui-sans-serif;
}
/* 12. Mocha */
body[data-theme="mocha"]{
  --bg:#110c09; --panel:#1a130f; --panel-2:#221912;
  --accent:#d6a676; --accent-2:#edc9a3; --text:#fff1e2; --muted:#cfbaaa; --line:#3a2a1d;
  --danger:#ff7b6e; --font-body: "Inter", ui-sans-serif;
}
/* 13. Arctic Ice */
body[data-theme="arctic-ice"]{
  --bg:#0b1014; --panel:rgba(255,255,255,0.05); --panel-2:rgba(255,255,255,0.08);
  --accent:#67e8f9; --accent-2:#a5f3fc; --text:#e6fbff; --muted:#b7e8f2; --line:rgba(135,206,235,0.28);
  --danger:#fb7185; --font-body: system-ui, -apple-system, Segoe UI, Roboto, "SF Pro Text", Arial;
}
/* 14. Neon Pop */
body[data-theme="neon-pop"]{
  --bg:#070b0f; --panel:#0c1218; --panel-2:#111a22;
  --accent:#22d3ee; --accent-2:#a78bfa; --text:#e5faff; --muted:#b8d4ff; --line:#162230;
  --danger:#ff5a89; --font-body: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}
/* 15. Royal Indigo */
body[data-theme="royal-indigo"]{
  --bg:#0a0a1a; --panel:#100f26; --panel-2:#151232;
  --accent:#7c3aed; --accent-2:#a78bfa; --text:#ecebff; --muted:#b9b4f2; --line:#251d46;
  --danger:#ff6b7a; --font-body: Inter, ui-sans-serif;
}
/* 16. Copper Sand */
body[data-theme="copper-sand"]{
  --bg:#0f0d0b; --panel:#17130f; --panel-2:#1f1a13;
  --accent:#e07a5f; --accent-2:#f2cc8f; --text:#fff3e6; --muted:#ddc3a6; --line:#2a2219;
  --danger:#ff7a7a; --font-body: Inter, ui-sans-serif;
}
/* 17. Aurora */
body[data-theme="aurora"]{
  --bg:#0b0e1a; --panel:#11162a; --panel-2:#151c36;
  --accent:#34d399; --accent-2:#60a5fa; --text:#e9faff; --muted:#b0d4ff; --line:#1a2a4d;
  --danger:#fb7185; --font-body: Inter, ui-sans-serif;
}
/* 18. Jade Mist */
body[data-theme="jade-mist"]{
  --bg:#081311; --panel:#0d1b18; --panel-2:#10241f;
  --accent:#2dd4bf; --accent-2:#99f6e4; --text:#dcfffb; --muted:#a6e9df; --line:#133a34;
  --danger:#f87171; --font-body: Inter, ui-sans-serif;
}
/* 19. Obsidian */
body[data-theme="obsidian"]{
  --bg:#070707; --panel:#0c0c0c; --panel-2:#121212;
  --accent:#22c55e; --accent-2:#86efac; --text:#f1f5f9; --muted:#9aa6b2; --line:#1c1c1c;
  --danger:#ef4444; --font-body: "JetBrains Mono", ui-monospace;
}
/* 20. Paper White */
body[data-theme="paper-white"]{
  --bg:#0c0d0f; --panel:rgba(255,255,255,0.06); --panel-2:rgba(255,255,255,0.1);
  --accent:#ffffff; --accent-2:#e5e7eb; --text:#f8fafc; --muted:#cbd5e1; --line:rgba(255,255,255,0.18);
  --danger:#f87171; --font-body: "SF Pro Text", ui-sans-serif, system-ui;
}

body[data-theme] header,
body[data-theme] .item,
body[data-theme] .engine{
  backdrop-filter: blur(10px) saturate(140%);
  -webkit-backdrop-filter: blur(10px) saturate(140%);
  border:1px solid var(--line);
}
body[data-theme] h1{ text-shadow:0 0 18px color-mix(in oklab, var(--accent) 35%, transparent); }

* { box-sizing: border-box; }
body {
  margin:0; background:var(--bg); color:var(--text);
  font-family: var(--font-body, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace);
}
header {
  position:sticky; top:0; z-index:20; background:linear-gradient(180deg,rgba(0,0,0,.24),rgba(0,0,0,.15));
  border-bottom:1px solid var(--line); padding:10px 14px; display:flex; align-items:center; gap:10px;
}
h1 { font-size:18px; margin:0; letter-spacing:1px; color:var(--accent); cursor:pointer; }
h1:focus-visible{ outline:2px solid var(--accent); border-radius:6px; }
header .btn { display:inline-flex; align-items:center; justify-content:center; padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:var(--panel-2); color:var(--muted); text-decoration:none; font-size:14px; height:36px; }
header .btn:hover { color:var(--text); border-color:var(--accent); }
.phone { margin-left:auto; }
.tg { margin-left:8px; }
.tg-icon { display:block; }

.pages { position:sticky; top:50px; z-index:15; padding:8px 10px; background:var(--panel); border-bottom:1px solid var(--line); }
.pages select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:var(--panel-2); color:var(--text); font-size:14px; }
.search { display:flex; gap:8px; padding:10px; background:var(--panel); border-bottom:1px solid var(--line); position:sticky; top:100px; z-index:14; }
.search input {
  flex:1; padding:12px 14px; border-radius:10px; border:1px solid var(--line); background:var(--panel-2);
  color:var(--text); font-size:16px; outline:none;
}
.container { padding: 10px; }
.section { display:none; }
.section.active { display:block; }

/* Card list */
.list { display:flex; flex-direction:column; gap:8px; }
.item { background:var(--panel-2); border:1px solid var(--line); border-radius:12px; padding:10px 12px; display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
.item .name { font-size:15px; letter-spacing:.2px;}
.item .price { font-weight:700; font-size:15px; color:var(--accent-2); text-shadow:0 0 6px rgba(0,0,0,.25);}
.small { font-size:12px; opacity:.7; }

/* Engine Room */
.engine-overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:flex-start; justify-content:center; z-index:100; overflow:auto; padding:20px 8px; }
.engine { width:min(900px,95vw); background:var(--panel); border:1px solid var(--accent); border-radius:14px; padding:14px; box-shadow:0 0 24px rgba(0,0,0,.25); max-height:90vh; overflow:auto; }
.engine h2 { margin:0 0 6px; color:var(--accent); font-size:18px; }
.engine .row { display:grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; gap:8px; margin:8px 0; }
.engine label { font-size:12px; color:var(--muted); }
.engine input[type="number"]{ width:100%; padding:8px; border-radius:8px; border:1px solid var(--line); background:var(--panel-2); color:var(--text); }
.engine .sheet-block { border:1px dashed var(--line); border-radius:12px; padding:12px; margin:10px 0; }
.engine .actions { display:flex; gap:8px; justify-content:flex-end; position:sticky; bottom:0; background:var(--panel); padding-top:8px; margin-top:8px; }
.engine button { padding:8px 12px; border-radius:10px; border:1px solid var(--line); background:var(--panel-2); color:var(--text); cursor:pointer; }
.engine .danger { border-color:var(--danger); color:#fff; }
.engine .pin { display:flex; gap:8px; align-items:center; margin:8px 0; }
.engine .pin input { flex:1; }
.engine .pin .ok { border-color:var(--accent); }

/* Theme selector UI */
.theme-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:10px; margin:10px 0; }
.theme-card { border:1px solid var(--line); border-radius:12px; overflow:hidden; background:var(--panel-2); cursor:pointer; }
.theme-swatch { height:48px; background:linear-gradient(135deg, var(--panel) 0%, var(--panel-2) 100%); }
.theme-card .lab { padding:8px; font-size:12px; color:var(--muted); display:flex; justify-content:space-between; align-items:center; }
.theme-card.active { outline:2px solid var(--accent); }

footer { padding:28px 14px; color:var(--muted); opacity:.75; }
@media (max-width:600px) {
  .engine .row { grid-template-columns:1fr 1fr; }
}
</style>
</head>
<body data-theme="midnight-glass">
<header>
  <h1 id="titleBtn" role="button" tabindex="0" aria-label="Open Engine Room">Allens List</h1>
  <a class="btn phone" href="tel:13135392838">(313) 539-2838</a>
  <a class="btn tg" href="https://t.me/apple_pays" target="_blank" rel="noopener" aria-label="Telegram channel">
    <svg class="tg-icon" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
      <path d="M21.5 3.5L2.7 10.8c-.8.3-.8 1.4 0 1.6l4.8 1.5 1.8 5.6c.2.8 1.2.9 1.7.3l2.6-2.7 4.8 3.6c.6.4 1.5.1 1.7-.6l3.2-15.2c.2-.9-.6-1.6-1.4-1.4zM8.4 12.9l9.5-6.1c.2-.1.4.2.2.3l-7.7 7.2c-.2.2-.3.4-.3.6l-.3 2.1c0 .2-.4.2-.4 0L8.4 12.9z" fill="currentColor"/>
    </svg>
  </a>
</header>
<div class="pages"><select id="sheetSelect"></select></div>
<div class="search">
  <input id="search" placeholder="Search devices (e.g. '15 Pro 256')">
</div>
<div class="container" id="sections"></div>

<div class="engine-overlay" id="engineOverlay" aria-hidden="true">
  <div class="engine">
    <h2>Engine Room</h2>
    <div class="pin">
      <label for="pinInput">Enter PIN to unlock settings</label>
    </div>
    <div class="pin">
      <input id="pinInput" type="password" placeholder="PIN">
      <button id="pinCheck" class="ok">Unlock</button>
      <button id="pinClose">Close</button>
    </div>
    <div id="engineBody" style="display:none;">
      <p class="small">Set per-page discount percentages by price range. Leave a field empty to fallback to defaults.</p>

      <!-- THEME PICKER -->
      <div class="sheet-block">
        <div style="display:flex; align-items:center; gap:10px; justify-content:space-between;">
          <div>
            <label for="themeSelect"><b>Theme</b></label>
            <select id="themeSelect" style="margin-left:8px; padding:6px; border-radius:8px; background:var(--panel-2); color:var(--text); border:1px solid var(--line);"></select>
          </div>
          <div>
            <button id="cycleTheme" title="Alt+T to cycle">Next Theme ▶</button>
          </div>
        </div>
        <div class="theme-grid" id="themeGrid"></div>
      </div>

      <div id="defaultsBlock" class="sheet-block">
        <label>Default discounts (used if a page value is blank):</label>
        <div class="row" id="defaultsRow"></div>
      </div>
      <div id="sheetsBlock"></div>
      <div class="actions">
        <button id="saveEngine">💾 Save</button>
        <button id="exportConfig">⬇️ Export Config</button>
        <button id="resetEngine" class="danger">Reset to Defaults</button>
        <button id="closeEngine">Done</button>
      </div>
    </div>
  </div>
</div>

<footer class="small">
  Prices are subject to change. We do not buy any stolen or unlawfully obtained devices.
</footer>

<script>
// ==== DATA ====
const DATASETS = {"New iPhone (Locked)":[{"device":"16 Pro Max 256GB","display":"16 Pro Max 256GB","price":730.0},{"device":"16 Pro Max 256GB Desert","display":"16 Pro Max 256GB Desert","price":730.0},{"device":"16 Pro Max 512GB","display":"16 Pro Max 512GB","price":825.0},{"device":"16 Pro Max 1TB","display":"16 Pro Max 1TB","price":920.0},{"device":"16 Pro 128GB","display":"16 Pro 128GB","price":570.0},{"device":"16 Pro 256GB","display":"16 Pro 256GB","price":660.0},{"device":"16 Pro 512GB","display":"16 Pro 512GB","price":730.0},{"device":"16 Pro 1TB","display":"16 Pro 1TB","price":800.0},{"device":"16 Plus 128GB","display":"16 Plus 128GB","price":430.0},{"device":"16 Plus 256GB","display":"16 Plus 256GB","price":490.0},{"device":"16 Plus 512GB","display":"16 Plus 512GB","price":575.0},{"device":"16E 128GB","display":"16E 128GB","price":220.0},{"device":"16E 256GB","display":"16E 256GB","price":270.0},{"device":"16E 512GB","display":"16E 512GB","price":330.0},{"device":"16 128GB","display":"16 128GB","price":395.0},{"device":"16 256GB","display":"16 256GB","price":475.0},{"device":"16 512GB","display":"16 512GB","price":520.0},{"device":"15 Pro Max 256GB Other colors","display":"15 Pro Max 256GB Other Colors","price":560.0},{"device":"15 Pro Max 256GB Natural","display":"15 Pro Max 256GB Natural","price":560.0},{"device":"15 Pro Max 512GB Other colors","display":"15 Pro Max 512GB Other Colors","price":620.0},{"device":"15 Pro Max 512GB Natural","display":"15 Pro Max 512GB Natural","price":620.0},{"device":"15 Pro Max 1TB Other colors","display":"15 Pro Max 1TB Other Colors","price":690.0},{"device":"15 Pro Max 1TB Natural","display":"15 Pro Max 1TB Natural","price":690.0},{"device":"15 Pro 128GB","display":"15 Pro 128GB","price":440.0},{"device":"15 Pro 256GB","display":"15 Pro 256GB","price":500.0},{"device":"15 Pro 512GB","display":"15 Pro 512GB","price":580.0},{"device":"15 Pro 1TB","display":"15 Pro 1TB","price":640.0},{"device":"15 Plus 128GB","display":"15 Plus 128GB","price":330.0},{"device":"15 Plus 256GB","display":"15 Plus 256GB","price":410.0},{"device":"15 Plus 512GB","display":"15 Plus 512GB","price":460.0},{"device":"15 128GB","display":"15 128GB","price":270.0},{"device":"15 256GB","display":"15 256GB","price":350.0},{"device":"15 512GB","display":"15 512GB","price":410.0}],"New iPhone(Unlocked)":[{"device":"16 Pro Max 256GB","display":"16 Pro Max 256GB","price":910.0},{"device":"16 Pro Max 256GB Desert","display":"16 Pro Max 256GB Desert","price":920.0},{"device":"16 Pro Max 512GB","display":"16 Pro Max 512GB","price":1100.0},{"device":"16 Pro Max 1TB","display":"16 Pro Max 1TB","price":1220.0},{"device":"16 Pro 128GB","display":"16 Pro 128GB","price":750.0},{"device":"16 Pro 256GB","display":"16 Pro 256GB","price":840.0},{"device":"16 Pro 512GB","display":"16 Pro 512GB","price":940.0},{"device":"16 Pro 1TB","display":"16 Pro 1TB","price":1040.0},{"device":"16 Plus 128GB","display":"16 Plus 128GB","price":600.0},{"device":"16 Plus 256GB","display":"16 Plus 256GB","price":690.0},{"device":"16 Plus 512GB","display":"16 Plus 512GB","price":740.0},{"device":"16 128GB","display":"16 128GB","price":550.0},{"device":"16 256GB","display":"16 256GB","price":620.0},{"device":"16 512GB","display":"16 512GB","price":650.0},{"device":"16E 128GB","display":"16E 128GB","price":320.0},{"device":"16E 256GB","display":"16E 256GB","price":400.0},{"device":"16E 512GB","display":"16E 512GB","price":490.0},{"device":"15 Pro Max 256GB","display":"15 Pro Max 256GB","price":810.0},{"device":"15 Pro Max 512GB","display":"15 Pro Max 512GB","price":890.0},{"device":"15 Pro Max 1TB","display":"15 Pro Max 1TB","price":920.0},{"device":"15 Pro 128GB","display":"15 Pro 128GB","price":680.0},{"device":"15 Pro 256GB","display":"15 Pro 256GB","price":780.0},{"device":"15 Pro 512GB","display":"15 Pro 512GB","price":810.0},{"device":"15 Pro 1TB","display":"15 Pro 1TB","price":860.0},{"device":"15 Plus 128GB","display":"15 Plus 128GB","price":480.0},{"device":"15 Plus 256GB","display":"15 Plus 256GB","price":560.0},{"device":"15 Plus 512GB","display":"15 Plus 512GB","price":600.0},{"device":"15 128GB","display":"15 128GB","price":460.0},{"device":"15 256GB","display":"15 256GB","price":520.0},{"device":"15 512GB","display":"15 512GB","price":550.0}],"Used iPhone(Unlocked)":[{"device":"16 Pro Max 256GB","display":"16 Pro Max 256GB","price":800.0},{"device":"16 Pro Max 512GB","display":"16 Pro Max 512GB","price":860.0},{"device":"16 Pro Max 1TB","display":"16 Pro Max 1TB","price":890.0},{"device":"16 Pro 128GB","display":"16 Pro 128GB","price":630.0},{"device":"16 Pro 256GB","display":"16 Pro 256GB","price":680.0},{"device":"16 Pro 512GB","display":"16 Pro 512GB","price":730.0},{"device":"16 Pro 1TB","display":"16 Pro 1TB","price":760.0},{"device":"16 Plus 128GB","display":"16 Plus 128GB","price":500.0},{"device":"16 Plus 256GB","display":"16 Plus 256GB","price":530.0},{"device":"16 Plus 512GB","display":"16 Plus 512GB","price":550.0},{"device":"16 128GB","display":"16 128GB","price":450.0},{"device":"16  256GB","display":"16 256GB","price":480.0},{"device":"16  512GB","display":"16 512GB","price":500.0},{"device":"16E 128GB","display":"16E 128GB","price":280.0},{"device":"16E  256GB","display":"16E 256GB","price":320.0},{"device":"16E  512GB","display":"16E 512GB","price":350.0},{"device":"15 Pro Max 256GB","display":"15 Pro Max 256GB","price":610.0},{"device":"15 Pro Max 512GB","display":"15 Pro Max 512GB","price":640.0},{"device":"15 Pro Max 1TB","display":"15 Pro Max 1TB","price":670.0},{"device":"15 Pro 128GB","display":"15 Pro 128GB","price":480.0},{"device":"15 Pro 256GB","display":"15 Pro 256GB","price":510.0},{"device":"15 Pro 512GB","display":"15 Pro 512GB","price":540.0},{"device":"15 Pro 1TB","display":"15 Pro 1TB","price":570.0},{"device":"15 Plus 128GB","display":"15 Plus 128GB","price":400.0},{"device":"15 Plus 256GB","display":"15 Plus 256GB","price":450.0},{"device":"15 Plus 512GB","display":"15 Plus 512GB","price":480.0},{"device":"15 128GB","display":"15 128GB","price":370.0},{"device":"15  256GB","display":"15 256GB","price":400.0},{"device":"15  512GB","display":"15 512GB","price":430.0},{"device":"14 Pro Max 128GB","display":"14 Pro Max 128GB","price":460.0},{"device":"14 Pro Max 256GB","display":"14 Pro Max 256GB","price":490.0},{"device":"14 Pro Max 512GB","display":"14 Pro Max 512GB","price":520.0},{"device":"14 Pro Max 1TB","display":"14 Pro Max 1TB","price":550.0},{"device":"14 Pro 128GB","display":"14 Pro 128GB","price":360.0},{"device":"14 Pro 256GB","display":"14 Pro 256GB","price":390.0},{"device":"14 Pro 512GB","display":"14 Pro 512GB","price":410.0},{"device":"14 Pro 1TB","display":"14 Pro 1TB","price":430.0},{"device":"14 Plus 128GB","display":"14 Plus 128GB","price":290.0},{"device":"14 Plus 256GB","display":"14 Plus 256GB","price":320.0},{"device":"14 Plus 512GB","display":"14 Plus 512GB","price":350.0},{"device":"14  128GB","display":"14 128GB","price":240.0},{"device":"14  256GB","display":"14 256GB","price":270.0},{"device":"14  512GB","display":"14 512GB","price":300.0},{"device":"13 Pro Max 128GB","display":"13 Pro Max 128GB","price":320.0},{"device":"13 Pro Max 256GB","display":"13 Pro Max 256GB","price":350.0},{"device":"13 Pro Max 512GB","display":"13 Pro Max 512GB","price":380.0},{"device":"13 Pro Max 1TB","display":"13 Pro Max 1TB","price":410.0},{"device":"13 Pro 128GB","display":"13 Pro 128GB","price":240.0},{"device":"13 Pro 256GB","display":"13 Pro 256GB","price":270.0},{"device":"13 Pro 512GB","display":"13 Pro 512GB","price":300.0},{"device":"13 Pro TB","display":"13 Pro TB","price":330.0},{"device":"13 128GB","display":"13 128GB","price":220.0},{"device":"13  256GB","display":"13 256GB","price":250.0},{"device":"13  512GB","display":"13 512GB","price":280.0},{"device":"13  Mini 128GB","display":"13 Mini 128GB","price":200.0},{"device":"13  Mini 256GB","display":"13 Mini 256GB","price":240.0},{"device":"13  Mini 512GB","display":"13 Mini 512GB","price":260.0},{"device":"SE 3nd 64GB","display":"SE 3nd 64GB","price":100.0},{"device":"SE 3nd 128GB","display":"SE 3nd 128GB","price":140.0},{"device":"SE 3nd 256GB","display":"SE 3nd 256GB","price":180.0},{"device":"12 Pro Max 128GB","display":"12 Pro Max 128GB","price":270.0},{"device":"12 Pro Max 256GB","display":"12 Pro Max 256GB","price":300.0},{"device":"12 Pro Max 512GB","display":"12 Pro Max 512GB","price":330.0},{"device":"12 Pro 128GB","display":"12 Pro 128GB","price":200.0},{"device":"12 Pro 256GB","display":"12 Pro 256GB","price":230.0},{"device":"12 Pro 512GB","display":"12 Pro 512GB","price":260.0},{"device":"12 64GB","display":"12 64GB","price":130.0},{"device":"12 128GB","display":"12 128GB","price":160.0},{"device":"12 256GB","display":"12 256GB","price":180.0},{"device":"12  Mini 64GB","display":"12 Mini 64GB","price":120.0},{"device":"12  Mini 128GB","display":"12 Mini 128GB","price":150.0},{"device":"12  Mini 256GB","display":"12 Mini 256GB","price":170.0},{"device":"11 Pro Max 64GB","display":"11 Pro Max 64GB","price":150.0},{"device":"11 Pro Max 256GB","display":"11 Pro Max 256GB","price":180.0},{"device":"11 Pro Max 512GB","display":"11 Pro Max 512GB","price":200.0},{"device":"11 Pro 64GB","display":"11 Pro 64GB","price":110.0},{"device":"11 Pro 256GB","display":"11 Pro 256GB","price":140.0},{"device":"11 Pro 512GB","display":"11 Pro 512GB","price":160.0},{"device":"11 64GB","display":"11 64GB","price":80.0},{"device":"11 128GB","display":"11 128GB","price":110.0},{"device":"11 256GB","display":"11 256GB","price":130.0},{"device":"SE 2020 64GB","display":"SE 2020 64GB","price":50.0},{"device":"SE 2020 128GB","display":"SE 2020 128GB","price":80.0},{"device":"SE 2020 256GB","display":"SE 2020 256GB","price":110.0},{"device":"Xs Max 64GB","display":"XS Max 64GB","price":30.0},{"device":"Xs Max 256GB","display":"XS Max 256GB","price":50.0},{"device":"Xs Max 512GB","display":"XS Max 512GB","price":80.0},{"device":"XS 64GB","display":"XS 64GB","price":20.0},{"device":"XS 256GB","display":"XS 256GB","price":20.0},{"device":"XS 512GB","display":"XS 512GB","price":20.0},{"device":"XR 64GB","display":"XR 64GB","price":10.0},{"device":"XR 128GB","display":"XR 128GB","price":10.0},{"device":"XR 256GB","display":"XR 256GB","price":10.0},{"device":"X 64GB","display":"X 64GB","price":10.0},{"device":"X 128GB","display":"X 128GB","price":10.0},{"device":"X 256GB","display":"X 256GB","price":10.0}],"Used iPhone(Locked)":[{"device":"16 Pro Max 256GB","display":"16 Pro Max 256GB","price":640.0},{"device":"16 Pro Max 512GB","display":"16 Pro Max 512GB","price":700.0},{"device":"16 Pro Max 1TB","display":"16 Pro Max 1TB","price":730.0},{"device":"16 Pro 128GB","display":"16 Pro 128GB","price":480.0},{"device":"16 Pro 256GB","display":"16 Pro 256GB","price":540.0},{"device":"16 Pro 512GB","display":"16 Pro 512GB","price":570.0},{"device":"16 Pro 1TB","display":"16 Pro 1TB","price":600.0},{"device":"16 Plus 128GB","display":"16 Plus 128GB","price":360.0},{"device":"16 Plus 256GB","display":"16 Plus 256GB","price":400.0},{"device":"16 Plus 512GB","display":"16 Plus 512GB","price":430.0},{"device":"16 128GB","display":"16 128GB","price":330.0},{"device":"16 256GB","display":"16 256GB","price":365.0},{"device":"16 512GB","display":"16 512GB","price":400.0},{"device":"16E 128GB","display":"16E 128GB","price":170.0},{"device":"16E 256GB","display":"16E 256GB","price":220.0},{"device":"16E 512GB","display":"16E 512GB","price":240.0},{"device":"15 Pro Max 256GB","display":"15 Pro Max 256GB","price":475.0},{"device":"15 Pro Max 512GB","display":"15 Pro Max 512GB","price":515.0},{"device":"15 Pro Max 1TB","display":"15 Pro Max 1TB","price":535.0},{"device":"15 Pro 128GB","display":"15 Pro 128GB","price":350.0},{"device":"15 Pro 256GB","display":"15 Pro 256GB","price":390.0},{"device":"15 Pro 512GB","display":"15 Pro 512GB","price":410.0},{"device":"15 Pro 1TB","display":"15 Pro 1TB","price":430.0},{"device":"15 Plus 128GB","display":"15 Plus 128GB","price":265.0},{"device":"15 Plus 256GB","display":"15 Plus 256GB","price":305.0},{"device":"15 Plus 512GB","display":"15 Plus 512GB","price":315.0},{"device":"15 128GB","display":"15 128GB","price":240.0},{"device":"15 256GB","display":"15 256GB","price":280.0},{"device":"15 512GB","display":"15 512GB","price":300.0},{"device":"14 Pro Max 128GB","display":"14 Pro Max 128GB","price":340.0},{"device":"14 Pro Max 256GB","display":"14 Pro Max 256GB","price":385.0},{"device":"14 Pro Max 512GB","display":"14 Pro Max 512GB","price":410.0},{"device":"14 Pro Max 1TB","display":"14 Pro Max 1TB","price":420.0},{"device":"14 Pro 128GB","display":"14 Pro 128GB","price":275.0},{"device":"14 Pro 256GB","display":"14 Pro 256GB","price":320.0},{"device":"14 Pro 512GB","display":"14 Pro 512GB","price":345.0},{"device":"14 Pro 1TB","display":"14 Pro 1TB","price":360.0},{"device":"14 Plus 128GB","display":"14 Plus 128GB","price":130.0},{"device":"14 Plus 256GB","display":"14 Plus 256GB","price":150.0},{"device":"14 Plus 512GB","display":"14 Plus 512GB","price":160.0},{"device":"14 128GB","display":"14 128GB","price":120.0},{"device":"14 256GB","display":"14 256GB","price":150.0},{"device":"14 512GB","display":"14 512GB","price":160.0},{"device":"13 Pro Max 128GB","display":"13 Pro Max 128GB","price":200.0},{"device":"13 Pro Max 256GB","display":"13 Pro Max 256GB","price":240.0},{"device":"13 Pro Max 512GB","display":"13 Pro Max 512GB","price":250.0},{"device":"13 Pro Max 1TB","display":"13 Pro Max 1TB","price":260.0},{"device":"13 Pro 128GB","display":"13 Pro 128GB","price":170.0},{"device":"13 Pro 256GB","display":"13 Pro 256GB","price":195.0},{"device":"13 Pro 512GB","display":"13 Pro 512GB","price":205.0},{"device":"13 Pro 1TB","display":"13 Pro 1TB","price":215.0},{"device":"13  128GB","display":"13 128GB","price":85.0},{"device":"13  256GB","display":"13 256GB","price":100.0},{"device":"13  512GB","display":"13 512GB","price":110.0},{"device":"13 Mini 128GB","display":"13 Mini 128GB","price":85.0},{"device":"13 Mini 256GB","display":"13 Mini 256GB","price":100.0},{"device":"13 Mini 512GB","display":"13 Mini 512GB","price":110.0},{"device":"SE 3nd 64GB","display":"SE 3nd 64GB","price":30.0},{"device":"SE 3nd 128GB","display":"SE 3nd 128GB","price":40.0},{"device":"SE 3nd 256GB","display":"SE 3nd 256GB","price":45.0},{"device":"12 Pro Max 128GB","display":"12 Pro Max 128GB","price":95.0},{"device":"12 Pro Max 256GB","display":"12 Pro Max 256GB","price":110.0},{"device":"12 Pro Max 512GB","display":"12 Pro Max 512GB","price":120.0},{"device":"12 Pro 128GB","display":"12 Pro 128GB","price":65.0},{"device":"12 Pro 256GB","display":"12 Pro 256GB","price":70.0},{"device":"12 Pro 512GB","display":"12 Pro 512GB","price":80.0},{"device":"12 64GB","display":"12 64GB","price":35.0},{"device":"12 128GB","display":"12 128GB","price":40.0},{"device":"12 256GB","display":"12 256GB","price":40.0},{"device":"12 Mini 64GB","display":"12 Mini 64GB","price":35.0},{"device":"12 Mini 128GB","display":"12 Mini 128GB","price":40.0},{"device":"12 Mini 256GB","display":"12 Mini 256GB","price":40.0}],"Macbook":[{"device":"MC6T4 Sky Blue 16GB/256GB","display":"Mc6t4 Sky Blue 16GB/256GB","price":720.0},{"device":"MW0W3 Silver 16GB/256GB","display":"Mw0w3 Silver 16GB/256GB","price":720.0},{"device":"MW123 Midnight 16GB/256GB","display":"Mw123 Midnight 16GB/256GB","price":720.0},{"device":"MW0Y3 Starlight 16GB/256GB","display":"Mw0y3 Starlight 16GB/256GB","price":720.0},{"device":"MC6U4 Sky Blue 16GB/512GB","display":"Mc6u4 Sky Blue 16GB/512GB","price":880.0},{"device":"MW0X3 Silver 16GB/512GB","display":"Mw0x3 Silver 16GB/512GB","price":880.0},{"device":"MW133 Midnight 16GB/512GB","display":"Mw133 Midnight 16GB/512GB","price":880.0},{"device":"MW103 Starlight 16GB/512GB","display":"Mw103 Starlight 16GB/512GB","price":880.0},{"device":"MC6V4 Sky Blue 24GB/512GB","display":"Mc6v4 Sky Blue 24GB/512GB","price":1040.0},{"device":"MC654 Silver 24GB/512GB","display":"Mc654 Silver 24GB/512GB","price":1040.0},{"device":"MC6C4 Midnight 24GB/512GB","display":"Mc6c4 Midnight 24GB/512GB","price":1040.0},{"device":"MC6A4 Starlight 24GB/512GB","display":"Mc6a4 Starlight 24GB/512GB","price":1040.0},{"device":"MC7A4 Sky Blue 16GB/256GB","display":"Mc7a4 Sky Blue 16GB/256GB","price":880.0},{"device":"MW1G3 Silver 16GB/256GB","display":"Mw1g3 Silver 16GB/256GB","price":880.0},{"device":"MW1L3 Midnight 16GB/256GB","display":"Mw1l3 Midnight 16GB/256GB","price":880.0},{"device":"MW1J3 Starlight 16GB/256GB","display":"Mw1j3 Starlight 16GB/256GB","price":880.0},{"device":"MC7C4 Sky Blue 16GB/512GB","display":"Mc7c4 Sky Blue 16GB/512GB","price":1050.0},{"device":"MW1H3 Silver 16GB/512GB","display":"Mw1h3 Silver 16GB/512GB","price":1050.0},{"device":"MW1M3 Midnight 16GB/512GB","display":"Mw1m3 Midnight 16GB/512GB","price":1050.0},{"device":"MW1K3 Starlight 16GB/512GB","display":"Mw1k3 Starlight 16GB/512GB","price":1050.0},{"device":"MC7D4 Sky Blue 24GB/512GB","display":"Mc7d4 Sky Blue 24GB/512GB","price":1200.0},{"device":"MC6J4 Silver 24GB/512GB","display":"Mc6j4 Silver 24GB/512GB","price":1200.0},{"device":"MC6L4 Midnight 24GB/512GB","display":"Mc6l4 Midnight 24GB/512GB","price":1200.0},{"device":"MC6K4 Starlight 24GB/512GB","display":"Mc6k4 Starlight 24GB/512GB","price":1200.0},{"device":"MC8G4 Space Gray 16GB/256GB","display":"Mc8g4 Space Gray 16GB/256GB","price":620.0},{"device":"MC8H4 Silver 16GB/256GB","display":"Mc8h4 Silver 16GB/256GB","price":620.0},{"device":"MC8J4 Starlight 16GB/256GB","display":"Mc8j4 Starlight 16GB/256GB","price":620.0},{"device":"MC8K4 Midnight 16GB/256GB","display":"Mc8k4 Midnight 16GB/256GB","price":620.0},{"device":"MC8M4 Space Gray 24GB/512GB","display":"Mc8m4 Space Gray 24GB/512GB","price":920.0},{"device":"MC8N4 Silver 24GB/512GB","display":"Mc8n4 Silver 24GB/512GB","price":920.0},{"device":"MC8P4 Starlight 24GB/512GB","display":"Mc8p4 Starlight 24GB/512GB","price":920.0},{"device":"MC8Q4 Midnight 24GB/512GB","display":"Mc8q4 Midnight 24GB/512GB","price":920.0},{"device":"MC9D4 Space Gray 16GB/256GB","display":"Mc9d4 Space Gray 16GB/256GB","price":850.0},{"device":"MC9E4 Silver 16GB/256GB","display":"Mc9e4 Silver 16GB/256GB","price":850.0},{"device":"MC9F4 Starlight 16GB/256GB","display":"Mc9f4 Starlight 16GB/256GB","price":850.0},{"device":"MC9G4 Midnight 16GB/256GB","display":"Mc9g4 Midnight 16GB/256GB","price":850.0},{"device":"MC9H4 Space Gray 24GB/512GB","display":"Mc9h4 Space Gray 24GB/512GB","price":1000.0},{"device":"MC9H4 Silver 24GB/512GB","display":"Mc9h4 Silver 24GB/512GB","price":1000.0},{"device":"MC9K4 Starlight 24GB/512GB","display":"Mc9k4 Starlight 24GB/512GB","price":1000.0},{"device":"MC9L4 Midnight 24GB/512GB","display":"Mc9l4 Midnight 24GB/512GB","price":1000.0},{"device":"MC7U4 Space Gray 16GB/256GB","display":"Mc7u4 Space Gray 16GB/256GB","price":580.0},{"device":"MC7V4 Silver 16GB/256GB","display":"Mc7v4 Silver 16GB/256GB","price":580.0},{"device":"MC7W4 Starlight 16GB/256GB","display":"Mc7w4 Starlight 16GB/256GB","price":580.0},{"device":"MC7X4 Midnight 16GB/256GB","display":"Mc7x4 Midnight 16GB/256GB","price":580.0},{"device":"MW2U3 16GB/512 GREY","display":"Mw2u3 16GB/512 Grey","price":1200.0},{"device":"MW2W3 16GB/512 SILVER","display":"Mw2w3 16GB/512 Silver","price":1200.0},{"device":"MW2V3 16GB/1TB SPACE","display":"Mw2v3 16GB/1TB Space","price":1330.0},{"device":"MW2X3 16GB/1TB SILVER","display":"Mw2x3 16GB/1TB Silver","price":1330.0},{"device":"MCX04 24GB/1TB SPACE","display":"Mcx04 24GB/1TB Space","price":1550.0},{"device":"MCX14 24GB/1TB SILVER","display":"Mcx14 24GB/1TB Silver","price":1500.0},{"device":"MX2H3 24GB/512GB SPACE GREY","display":"Mx2h3 24GB/512GB Space Grey","price":1500.0},{"device":"MX2E3 24GB/512GB SILVER","display":"Mx2e3 24GB/512GB Silver","price":1500.0},{"device":"MX2J3 24GB/1TBGB SPACE GREY","display":"Mx2j3 24GB/1TBGB Space Grey","price":1800.0},{"device":"MX2F3 24GB/1TBGB SILVER","display":"Mx2f3 24GB/1TBGB Silver","price":1800.0},{"device":"MX2K3 36GB/1TB SPACE GREY","display":"Mx2k3 36GB/1TB Space Grey","price":2000.0},{"device":"MX2G3 36GB/1TB SILVER","display":"Mx2g3 36GB/1TB Silver","price":2000.0},{"device":"MX2X3 24GB/512GB SPACE GREY","display":"Mx2x3 24GB/512GB Space Grey","price":1900.0},{"device":"MX2T3 24GB/512GB SILVER","display":"Mx2t3 24GB/512GB Silver","price":1900.0},{"device":"MX2Y3 48GB/512GB SPACE GREY","display":"Mx2y3 48GB/512GB Space Grey","price":2000.0},{"device":"MX2U3 48GB/512GBSILVER","display":"Mx2u3 48GB/512GBSILVER","price":2000.0},{"device":"MX303 36GB/1TB SPACE GREY","display":"Mx303 36GB/1TB Space Grey","price":2600.0},{"device":"MX2V3 36GB/1TB SILVER","display":"Mx2v3 36GB/1TB Silver","price":2600.0},{"device":"MX313 48GB/1TB SPACE GREY","display":"Mx313 48GB/1TB Space Grey","price":2950.0},{"device":"MX2W3 48GB/1TB SILVER","display":"Mx2w3 48GB/1TB Silver","price":2950.0},{"device":"MRXN3 MRXQ3 MRXT3 MRXV3 8GB/256GB","display":"Mrxn3 Mrxq3 Mrxt3 Mrxv3 8GB/256GB","price":630.0},{"device":"MRXP3 MRXR3 MRXU3 MRXW3 8GB/512GB","display":"Mrxp3 Mrxr3 Mrxu3 Mrxw3 8GB/512GB","price":750.0},{"device":"MXCR3 MXCT3 MXCU3 MXCV3 16GB/512GB","display":"Mxcr3 Mxct3 Mxcu3 Mxcv3 16GB/512GB","price":830.0},{"device":"MRYM3 MRYP3 MRYR3 MRYU3 8GB/256GB","display":"Mrym3 Mryp3 Mryr3 Mryu3 8GB/256GB","price":730.0},{"device":"MRYN3 MRYQ3 MRYT3 MRYV3 8GB/512GB","display":"Mryn3 Mryq3 Mryt3 Mryv3 8GB/512GB","price":830.0},{"device":"MXD13 MXD23 MXD33 MXD43 16GB/512GB","display":"Mxd13 Mxd23 Mxd33 Mxd43 16GB/512GB","price":930.0},{"device":"MTL73 10C/8GB/512GB/Space Gray (M3)","display":"Mtl73 10C/8GB/512GB/Space Gray M3","price":930.0},{"device":"MR7J3 10C/8GB/512GB/Silver (M3)","display":"Mr7j3 10C/8GB/512GB/Silver M3","price":930.0},{"device":"MXE03 10C/16GB/1TB/Silver (M3)","display":"Mxe03 10C/16GB/1TB/Silver M3","price":1040.0},{"device":"MTL83 10C/8GB/1TB/Space Gray(M3)","display":"Mtl83 10C/8GB/1TB/Space Gray M3","price":1040.0},{"device":"MT7K3 10C/8GB/1TB/Silver(M3)","display":"Mt7k3 10C/8GB/1TB/Silver M3","price":1040.0},{"device":"MRX33 14C/18GB/512GB/Space Black (M3Pro)","display":"Mrx33 14C/18GB/512GB/Space Black M3pro","price":1240.0},{"device":"MRX63 14C/18GB/512GB/Silver (M3Pro)","display":"Mrx63 14C/18GB/512GB/Silver M3pro","price":1240.0},{"device":"MRX43 18C/18GB/1TB/ Space Black (M3Pro)","display":"Mrx43 18C/18GB/1TB/ Space Black M3pro","price":1560.0},{"device":"MRX73 18C/18GB/1TB/ Silver (M3Pro)","display":"Mrx73 18C/18GB/1TB/ Silver M3pro","price":1560.0},{"device":"MRX53 30C/36GB/1TB/Space Black(M3 Max)","display":"Mrx53 30C/36GB/1TB/Space Black M3 Max","price":1850.0},{"device":"MRX83 30C/36GB/1TB/Silver(M3 Max)","display":"Mrx83 30C/36GB/1TB/Silver M3 Max","price":1850.0},{"device":"MRW13 18C/18GB/512GB/Space Black(M3 Pro)","display":"Mrw13 18C/18GB/512GB/Space Black M3 Pro","price":1600.0},{"device":"MRW43 18C/18GB/512GB/Silver(M3 Pro)","display":"Mrw43 18C/18GB/512GB/Silver M3 Pro","price":1600.0},{"device":"MRW23 18C/36GB/512GB/Space Black(M3 Pro)","display":"Mrw23 18C/36GB/512GB/Space Black M3 Pro","price":1800.0},{"device":"MRW63 18C/36GB/512GB/Silver(M3 Pro)","display":"Mrw63 18C/36GB/512GB/Silver M3 Pro","price":1800.0},{"device":"MRW33 30C/36GB/1TB/Space Black(M3 Max)","display":"Mrw33 30C/36GB/1TB/Space Black M3 Max","price":2100.0},{"device":"MRW73 30C/36GB/1TB/SILVER(M3 Max)","display":"Mrw73 30C/36GB/1TB/SILVER M3 Max","price":2100.0},{"device":"MUW63 40C/48GB/1TB/Space Black(M3 Max)","display":"Muw63 40C/48GB/1TB/Space Black M3 Max","price":2200.0},{"device":"MUW73 40C/48GB/1TB/SILVER(M3 Max)","display":"Muw73 40C/48GB/1TB/SILVER M3 Max","price":2200.0},{"device":"MLY13 8C/8GB/256GB Starlight","display":"Mly13 8C/8GB/256GB Starlight","price":530.0},{"device":"MLXW3 8C/8GB/256GB SpaceGray","display":"Mlxw3 8C/8GB/256GB Spacegray","price":530.0},{"device":"MLXY3 8C/8GB/256GB Silver","display":"Mlxy3 8C/8GB/256GB Silver","price":530.0},{"device":"MLY33 8C/8GB/256GB Midnight","display":"Mly33 8C/8GB/256GB Midnight","price":530.0},{"device":"MLY23 8C/8GB/512GB Starlight","display":"Mly23 8C/8GB/512GB Starlight","price":630.0},{"device":"MLXX3 8C/8GB/512GB SpaceGray","display":"Mlxx3 8C/8GB/512GB Spacegray","price":630.0},{"device":"MLY03 8C/8GB/512GB Silver","display":"Mly03 8C/8GB/512GB Silver","price":630.0},{"device":"MLY43 8C/8GB/512GB Midnight","display":"Mly43 8C/8GB/512GB Midnight","price":630.0},{"device":"MGN63LL/A 8GB/ 256GB Gray","display":"Mgn63ll/a 8GB/ 256GB Gray","price":450.0},{"device":"MGN93LL/A 8GB/256GB Silver","display":"Mgn93ll/a 8GB/256GB Silver","price":450.0},{"device":"MGND3LL/A 8GB/256GB Gold","display":"Mgnd3ll/a 8GB/256GB Gold","price":450.0}],"iPad":[{"device":"2025 IPad 11 128GB wifi","display":"2025 iPad 11 128GB Wifi","price":240.0},{"device":"2025 IPad 11 256GB wifi","display":"2025 iPad 11 256GB Wifi","price":320.0},{"device":"2025 IPad 11 512GB wifi","display":"2025 iPad 11 512GB Wifi","price":430.0},{"device":"2025 IPad 11 128GB 5G","display":"2025 iPad 11 128GB 5GB","price":330.0},{"device":"2025 IPad 11 256GB 5G","display":"2025 iPad 11 256GB 5GB","price":450.0},{"device":"2025 IPad 11 512GB 5G","display":"2025 iPad 11 512GB 5GB","price":580.0},{"device":"2025 IPad Air 11 128GB wifi","display":"2025 iPad Air 11 128GB Wifi","price":400.0},{"device":"2025 IPad Air 11 256GB wifi","display":"2025 iPad Air 11 256GB Wifi","price":510.0},{"device":"2025 IPad Air 11 512GB wifi","display":"2025 iPad Air 11 512GB Wifi","price":610.0},{"device":"2025 IPad Air 11 1TB wifi","display":"2025 iPad Air 11 1TB Wifi","price":700.0},{"device":"2025 IPad Air 11 128GB 5G","display":"2025 iPad Air 11 128GB 5GB","price":560.0},{"device":"2025 IPad Air 11 256GB 5G","display":"2025 iPad Air 11 256GB 5GB","price":660.0},{"device":"2025 IPad Air 11 512GB 5G","display":"2025 iPad Air 11 512GB 5GB","price":760.0},{"device":"2025 IPad Air 11 1TB 5G","display":"2025 iPad Air 11 1TB 5GB","price":800.0},{"device":"2025 IPad Air 13 128GB wifi","display":"2025 iPad Air 13 128GB Wifi","price":580.0},{"device":"2025 IPad Air 13 256GB wifi","display":"2025 iPad Air 13 256GB Wifi","price":680.0},{"device":"2025 IPad Air 13 512GB wifi","display":"2025 iPad Air 13 512GB Wifi","price":730.0},{"device":"2025 IPad Air 13 1TB wifi","display":"2025 iPad Air 13 1TB Wifi","price":780.0},{"device":"2025 IPad Air 13 128GB 5G","display":"2025 iPad Air 13 128GB 5GB","price":630.0},{"device":"2025 IPad Air 13 256GB 5G","display":"2025 iPad Air 13 256GB 5GB","price":730.0},{"device":"2025 IPad Air 13 512GB 5G","display":"2025 iPad Air 13 512GB 5GB","price":780.0},{"device":"2025 IPad Air 13 1TB 5G","display":"2025 iPad Air 13 1TB 5GB","price":800.0},{"device":"Pro 13-inch 7TH 256GB Wifi","display":"Pro 13-inch 7TH 256GB Wifi","price":930.0},{"device":"Pro 13-inch 7TH 512GB Wifi","display":"Pro 13-inch 7TH 512GB Wifi","price":1120.0},{"device":"Pro 13-inch 7TH 1TB Wifi","display":"Pro 13-inch 7TH 1TB Wifi","price":1340.0},{"device":"Pro 13-inch 7TH 2TB Wifi","display":"Pro 13-inch 7TH 2TB Wifi","price":1440.0},{"device":"Pro 13-inch 7TH 256GB 5G","display":"Pro 13-inch 7TH 256GB 5GB","price":990.0},{"device":"Pro 13-inch 7TH 512GB 5G","display":"Pro 13-inch 7TH 512GB 5GB","price":1220.0},{"device":"Pro 13-inch 7TH 1TB 5G","display":"Pro 13-inch 7TH 1TB 5GB","price":1360.0},{"device":"Pro 13-inch 7TH 2TB 5G","display":"Pro 13-inch 7TH 2TB 5GB","price":1460.0},{"device":"Pro 11-inch 5TH 256GB Wifi","display":"Pro 11-inch 5TH 256GB Wifi","price":750.0},{"device":"Pro 11-inch 5TH 512GB Wifi","display":"Pro 11-inch 5TH 512GB Wifi","price":900.0},{"device":"Pro 11-inch 5TH 1TB Wifi","display":"Pro 11-inch 5TH 1TB Wifi","price":1000.0},{"device":"Pro 11-inch 5TH 2TB Wifi","display":"Pro 11-inch 5TH 2TB Wifi","price":1100.0},{"device":"Pro 11-inch 5TH 256GB 5G","display":"Pro 11-inch 5TH 256GB 5GB","price":950.0},{"device":"Pro 11-inch 5TH 512GB 5G","display":"Pro 11-inch 5TH 512GB 5GB","price":1060.0},{"device":"Pro 11-inch 5TH 1TB 5G","display":"Pro 11-inch 5TH 1TB 5GB","price":1160.0},{"device":"Pro 11-inch 5TH 2TB 5G","display":"Pro 11-inch 5TH 2TB 5GB","price":1260.0},{"device":"2024 Air6 11-inch 128GB Wifi","display":"2024 Air6 11-inch 128GB Wifi","price":380.0},{"device":"2024 Air6 11-inch 256GB Wifi","display":"2024 Air6 11-inch 256GB Wifi","price":460.0},{"device":"2024 Air6 11-inch 512GB Wifi","display":"2024 Air6 11-inch 512GB Wifi","price":560.0},{"device":"2024 Air6 11-inch 1TB Wifi","display":"2024 Air6 11-inch 1TB Wifi","price":620.0},{"device":"2024 Air6 11-inch 128GB 5G","display":"2024 Air6 11-inch 128GB 5GB","price":510.0},{"device":"2024 Air6 11-inch 256GB 5G","display":"2024 Air6 11-inch 256GB 5GB","price":580.0},{"device":"2024 Air6 11-inch 512GB 5G","display":"2024 Air6 11-inch 512GB 5GB","price":630.0},{"device":"2024 Air6  11-inch 1TB 5G","display":"2024 Air6 11-inch 1TB 5GB","price":680.0},{"device":"2024 Air6 13-inch 128GB Wifi","display":"2024 Air6 13-inch 128GB Wifi","price":480.0},{"device":"2024 Air6 13-inch 256GB Wifi","display":"2024 Air6 13-inch 256GB Wifi","price":580.0},{"device":"2024 Air6 13-inch 512GB Wifi","display":"2024 Air6 13-inch 512GB Wifi","price":680.0},{"device":"2024 Air6 13-inch 1TB Wifi","display":"2024 Air6 13-inch 1TB Wifi","price":740.0},{"device":"2024 Air6 13-inch 128GB 5G","display":"2024 Air6 13-inch 128GB 5GB","price":580.0},{"device":"2024 Air6 13-inch 256GB 5G","display":"2024 Air6 13-inch 256GB 5GB","price":680.0},{"device":"2024 Air6 13-inch 512GB 5G","display":"2024 Air6 13-inch 512GB 5GB","price":730.0},{"device":"2024 Air6 13-inch 1TB 5G","display":"2024 Air6 13-inch 1TB 5GB","price":780.0},{"device":"2024 iPad Mini 7 128G WiFi","display":"2024 iPad Mini 7 128GB Wifi","price":310.0},{"device":"2024 iPad Mini 7 256G WiFi","display":"2024 iPad Mini 7 256GB Wifi","price":380.0},{"device":"2024 iPad Mini 7 128G Cellular","display":"2024 iPad Mini 7 128GB Cellular","price":450.0},{"device":"2024 iPad Mini 7 256G Cellular","display":"2024 iPad Mini 7 256GB Cellular","price":550.0},{"device":"iPad 10th 64GB WiFi","display":"iPad 10th 64GB Wifi","price":200.0},{"device":"iPad 10th 256GB WiFi","display":"iPad 10th 256GB Wifi","price":350.0},{"device":"10th 64GB Cellular","display":"10th 64GB Cellular","price":250.0},{"device":"10th 256GB Cellular","display":"10th 256GB Cellular","price":460.0},{"device":"9th 64GB WiFi","display":"9th 64GB Wifi","price":150.0},{"device":"9th 256GB WiFi","display":"9th 256GB Wifi","price":220.0},{"device":"9th 64GB Cellular","display":"9th 64GB Cellular","price":190.0},{"device":"9th 256GB Cellular","display":"9th 256GB Cellular","price":270.0}],"iWatch&Airpod":[{"device":"SE2 40MM","display":"Se2 40MM","price":115.0},{"device":"SE2 44MM","display":"Se2 44MM","price":140.0},{"device":"S 10 42MM","display":"S 10 42MM","price":245.0},{"device":"S 10 46MM","display":"S 10 46MM","price":275.0},{"device":"Ultra 2 49MM Natural","display":"Ultra 2 49MM Natural","price":580.0},{"device":"Ultra 2 49MM Black","display":"Ultra 2 49MM Black","price":580.0},{"device":"S9 41MM","display":"S9 41MM","price":165.0},{"device":"S9 45MM","display":"S9 45MM","price":195.0},{"device":"Ultra 2 49MM","display":"Ultra 2 49MM","price":510.0},{"device":"AirPods 4TH(MXP63)","display":"AirPods 4TH Mxp63","price":65.0},{"device":"AirPods 4TH(MXP93)","display":"AirPods 4TH Mxp93","price":115.0},{"device":"AirPods Pro 2 (MTJV3) 2023","display":"AirPods Pro 2 Mtjv3 2023","price":135.0},{"device":"AirPods Pro 2 (MQD83) 2023","display":"AirPods Pro 2 Mqd83 2023","price":100.0},{"device":"AirPods Pro （MWP22)（MLWK3）","display":"AirPods Pro Mwp22 Mlwk3","price":80.0},{"device":"Airpods 3rd Gen（MPNY3)","display":"AirPods 3rd Gen Mpny3","price":45.0},{"device":"Airpods 3rd Gen（MME73)","display":"AirPods 3rd Gen Mme73","price":55.0},{"device":"AirPods 2nd Gen (MV7N2AM)","display":"AirPods 2nd Gen Mv7n2am","price":35.0},{"device":"AirPods 2nd Gen Wireless (MRXJ2AM)","display":"AirPods 2nd Gen Wireless Mrxj2am","price":35.0},{"device":"keyboard for IPAD PRO 11-INCH(M4)MWR23)(MWR03)","display":"Keyboard For iPad Pro 11-inch M4 Mwr23 Mwr03","price":135.0},{"device":"keyboard for IPAD PRO 13-INCH(M4)","display":"Keyboard For iPad Pro 13-inch M4","price":180.0}],"Samsung(Unlocked)":[{"device":"Z Fold7","display":"Z Fold7","price":1030.0},{"device":"Z Flip7","display":"Z Flip7","price":570.0},{"device":"S25E","display":"S25e","price":510.0},{"device":"S25U","display":"S25u","price":635.0},{"device":"S25+","display":"S25+","price":420.0},{"device":"S25","display":"S25","price":360.0},{"device":"Z Fold 6","display":"Z Fold 6","price":670.0},{"device":"Z Flip 6","display":"Z Flip 6","price":320.0},{"device":"S24U","display":"S24u","price":460.0},{"device":"S24+","display":"S24+","price":280.0},{"device":"S24","display":"S24","price":180.0},{"device":"Z Fold 5","display":"Z Fold 5","price":400.0},{"device":"Z Flip 5","display":"Z Flip 5","price":150.0},{"device":"S23U","display":"S23u","price":260.0},{"device":"S23+","display":"S23+","price":150.0},{"device":"S23","display":"S23","price":100.0},{"device":"S22U","display":"S22u","price":170.0},{"device":"S22+","display":"S22+","price":120.0},{"device":"S22","display":"S22","price":80.0},{"device":"S21U","display":"S21u","price":110.0},{"device":"S21+","display":"S21+","price":70.0},{"device":"S21","display":"S21","price":60.0},{"device":"Note 20U","display":"Note 20U","price":110.0},{"device":"Note 20","display":"Note 20","price":50.0},{"device":"Z Flip 4","display":"Z Flip 4","price":120.0},{"device":"Z Fold 4","display":"Z Fold 4","price":300.0},{"device":"S20U","display":"S20u","price":50.0},{"device":"S20","display":"S20","price":30.0}],"Samsung(Locked)":[{"device":"Z Fold7 TM/SP/VZN","display":"Z Fold7 Tm/sp/vzn","price":900.0},{"device":"Z Fold7 AT&T","display":"Z Fold7 At T","price":900.0},{"device":"Z Flip7 TM/SP/VZN","display":"Z Flip7 Tm/sp/vzn","price":440.0},{"device":"Z Flip7 AT&T","display":"Z Flip7 At T","price":440.0},{"device":"S25E TM/SP/VZN","display":"S25e Tm/sp/vzn","price":380.0},{"device":"S25E AT&T","display":"S25e At T","price":380.0},{"device":"S25U TM/SP/VZN","display":"S25u Tm/sp/vzn","price":505.0},{"device":"S25U AT&T","display":"S25u At T","price":505.0},{"device":"S25+ TM/SP/VZN","display":"S25+ Tm/sp/vzn","price":290.0},{"device":"S25+ AT&T","display":"S25+ At T","price":290.0},{"device":"S25 TM/SP/VZN","display":"S25 Tm/sp/vzn","price":230.0},{"device":"S25 AT&T","display":"S25 At T","price":230.0},{"device":"Z Fold 6 TM/SP/VZN","display":"Z Fold 6 Tm/sp/vzn","price":520.0},{"device":"Z Fold 6 AT&T","display":"Z Fold 6 At T","price":560.0},{"device":"Z Flip 6 TM/SP/VZN","display":"Z Flip 6 Tm/sp/vzn","price":210.0},{"device":"Z Flip 6 AT&T","display":"Z Flip 6 At T","price":250.0},{"device":"S24U TM/SP/VZN","display":"S24u Tm/sp/vzn","price":330.0},{"device":"S24U AT&T","display":"S24u At T","price":360.0},{"device":"S24+ TM/SP/VZN","display":"S24+ Tm/sp/vzn","price":160.0},{"device":"S24+ AT&T","display":"S24+ At T","price":190.0},{"device":"S24 TM/SP/VZN","display":"S24 Tm/sp/vzn","price":90.0},{"device":"S24 AT&T","display":"S24 At T","price":110.0},{"device":"S24FE TM/SP/VZN","display":"S24fe Tm/sp/vzn","price":100.0},{"device":"S24FE AT&T","display":"S24fe At T","price":100.0},{"device":"Z Fold 5 TM/SP/VZN","display":"Z Fold 5 Tm/sp/vzn","price":260.0},{"device":"Z Fold 5 AT&T","display":"Z Fold 5 At T","price":310.0},{"device":"Z Flip 5 TM/SP/VZN","display":"Z Flip 5 Tm/sp/vzn","price":80.0},{"device":"Z Flip 5 AT&T","display":"Z Flip 5 At T","price":110.0},{"device":"S23U TM/SP/VZN","display":"S23u Tm/sp/vzn","price":230.0},{"device":"S23U AT&T","display":"S23u At T","price":270.0},{"device":"S23+ TM/SP/VZN","display":"S23+ Tm/sp/vzn","price":90.0},{"device":"S23+ AT&T","display":"S23+ At T","price":120.0},{"device":"S23 TM/SP/VZN","display":"S23 Tm/sp/vzn","price":50.0},{"device":"S23 AT&T","display":"S23 At T","price":90.0},{"device":"S22U TM/SP/VZN","display":"S22u Tm/sp/vzn","price":60.0},{"device":"S22U AT&T","display":"S22u At T","price":80.0},{"device":"S22+ TM/SP/VZN","display":"S22+ Tm/sp/vzn","price":50.0},{"device":"S22+ AT&T","display":"S22+ At T","price":70.0},{"device":"S22 TM/SP/VZN","display":"S22 Tm/sp/vzn","price":30.0},{"device":"S22 AT&T","display":"S22 At T","price":70.0},{"device":"S21U TM/SP/VZN","display":"S21u Tm/sp/vzn","price":30.0},{"device":"S21U AT&T","display":"S21u At T","price":70.0},{"device":"S21+ TM/SP/VZN","display":"S21+ Tm/sp/vzn","price":20.0},{"device":"S21+ AT&T","display":"S21+ At T","price":60.0},{"device":"S21 TM/SP/VZN","display":"S21 Tm/sp/vzn","price":20.0},{"device":"S21 AT&T","display":"S21 At T","price":60.0},{"device":"Note 20U TM/SP/VZN","display":"Note 20U Tm/sp/vzn","price":60.0},{"device":"Note 20U AT&T","display":"Note 20U At T","price":100.0},{"device":"Note 20 TM/SP/VZN","display":"Note 20 Tm/sp/vzn","price":10.0},{"device":"Note 20 AT&T","display":"Note 20 At T","price":60.0},{"device":"Z Flip 4 TM/SP/VZN","display":"Z Flip 4 Tm/sp/vzn","price":20.0},{"device":"Z Flip 4 AT&T","display":"Z Flip 4 At T","price":60.0},{"device":"Z Fold 4 TM/SP/VZN","display":"Z Fold 4 Tm/sp/vzn","price":140.0},{"device":"Z Fold 4 AT&T","display":"Z Fold 4 At T","price":170.0},{"device":"S20U TM/SP/VZN","display":"S20u Tm/sp/vzn","price":10.0},{"device":"S20U AT&T","display":"S20u At T","price":40.0},{"device":"S20 TM/SP/VZN","display":"S20 Tm/sp/vzn","price":10.0},{"device":"S20 AT&T","display":"S20 At T","price":30.0}]};
const DEFAULT_RULES = {"1-100":30,"101-220":20,"221-300":15,"301-469":13,"470+":10};
const PRICE_BUCKETS = [["1-100", 1, 100], ["101-220", 101, 220], ["221-300", 221, 300], ["301-469", 301, 469], ["470+", 470, Infinity]];
const PIN_SHA256 = "5db1fee4b5703808c48078a76768b155b421b210c0761cd6a5d223f4d99f1eaa";

// ==== THEMES ====
const THEMES = [
  "midnight-glass","clean-pro","ivory-gold-luxe","carbon-neon","deep-purple",
  "forest-emerald","rose-quartz","sunset-gold","ocean-breeze","matte-black",
  "slate-gray","mocha","arctic-ice","neon-pop","royal-indigo",
  "copper-sand","aurora","jade-mist","obsidian","paper-white"
];
function applyTheme(name){
  if(!THEMES.includes(name)) name = "midnight-glass";
  document.body.setAttribute("data-theme", name);
  localStorage.setItem("uiThemeV1", name);
}
function loadTheme(){
  const t = localStorage.getItem("uiThemeV1") || "midnight-glass";
  applyTheme(t);
}
function cycleTheme(){
  const cur = document.body.getAttribute("data-theme") || "midnight-glass";
  const i = THEMES.indexOf(cur);
  const next = THEMES[(i+1)%THEMES.length];
  applyTheme(next);
  syncThemeUI();
}

// ==== CONFIG (localStorage only) ====
function getEngineConfig() {
  const raw = localStorage.getItem('engineConfigV1');
  if (!raw) return { defaults: DEFAULT_RULES, perSheet: {} };
  try { return JSON.parse(raw); } catch (e) { return { defaults: DEFAULT_RULES, perSheet: {} }; }
}
function setEngineConfig(cfg) {
  localStorage.setItem('engineConfigV1', JSON.stringify(cfg));
}
function downloadConfigFile(cfg) {
  const blob = new Blob([JSON.stringify(cfg, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'config.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

// ==== SEARCH NORMALIZATION ====
function normText(s) {
  if (!s) return '';
  s = String(s).toLowerCase();
  s = s.replace(/["”]/g, ' inch ');
  s = s.replace(/\b(\d+)\s*-\s*inch\b/g, '$1 inch');
  s = s.replace(/\b(\d+)\s*inch(es)?\b/g, '$1 inch');
  s = s.replace(/-/g, ' ');
  s = s.replace(/\b([2-6])\s*g\b/g, '$1g');
  s = s.replace(/[^a-z0-9\. ]+/g, ' ');
  s = s.replace(/\s+/g, ' ').trim();
  return s;
}
function buildSearchBlob(name, sheetName) {
  const base = normText(name);
  const stripped = base.replace(/\b(ipad|iphone|apple|samsung)\b/g, '').replace(/\s+/g,' ').trim();
  let sheetPart = '';
  if (sheetName) { sheetPart = ' ' + normText(String(sheetName)); }
  const merged = (base + ' ' + stripped + sheetPart).trim();
  return merged;
}

// ==== FUZZY MATCH (partial-word) ====
function levenshtein(a,b){
  a = a||''; b = b||'';
  const m = a.length, n = b.length;
  if (a === b) return 0;
  if (!m) return n;
  if (!n) return m;
  const dp = new Array(n+1);
  for (let j=0;j<=n;j++) dp[j]=j;
  for (let i=1;i<=m;i++){
    let prev = dp[0];
    dp[0] = i;
    for (let j=1;j<=n;j++){
      const tmp = dp[j];
      const cost = a[i-1] === b[j-1] ? 0 : 1;
      dp[j] = Math.min(
        dp[j] + 1,
        dp[j-1] + 1,
        prev + cost
      );
      prev = tmp;
    }
  }
  return dp[n];
}
function fuzzyTokenMatch(token, hayTokens){
  if (!token) return true;
  const t = token;
  for (const h of hayTokens){
    if (h.includes(t)) return true;
  }
  const maxEd = t.length >= 6 ? 2 : 1;
  for (const h of hayTokens){
    if (Math.abs(h.length - t.length) > 3) continue;
    const d = levenshtein(t, h);
    if (d <= maxEd) return true;
  }
  return false;
}
function matchesQuery(row, q) {
  if (!q) return true;
  const hay = row.search;
  const nq = normText(q);
  const tokens = nq.split(' ').filter(Boolean);
  if (!tokens.length) return true;
  const hayTokens = hay.split(' ').filter(Boolean);
  for (const tok of tokens) {
    if (!fuzzyTokenMatch(tok, hayTokens)) return false;
  }
  return true;
}

// ==== NEW: RANKING by closeness ====
function extractNums(tokens){
  const out=[];
  for(const t of tokens){
    const m = t.match(/^\d+(?:\.\d+)?$/);
    if(m){ out.push(parseFloat(m[0])); }
  }
  return out;
}
function rankScore(row, q){
  const hay = row.search || '';
  const nq = normText(q || '');
  if(!nq) return 0;
  const tokens = nq.split(' ').filter(Boolean);
  const hayTokens = hay.split(' ').filter(Boolean);
  let score = 0;

  // Whole-phrase / bigram boosts
  if(hay.includes(nq)) score += 40;
  for(let i=0;i<tokens.length-1;i++){
    const phrase = tokens[i] + ' ' + tokens[i+1];
    if(hay.includes(phrase)) score += 12;
  }

  // Token-level scoring
  for(const tok of tokens){
    let best = 0;
    for(const h of hayTokens){
      if(h === tok){ best = Math.max(best, 10); continue; }
      if(h.startsWith(tok) || h.includes(tok)){ best = Math.max(best, 6); continue; }
      const maxEd = tok.length >= 6 ? 2 : 1;
      if(Math.abs(h.length - tok.length) <= 3 && levenshtein(tok,h) <= maxEd){
        best = Math.max(best, 3);
      }
    }
    score += best;
  }

  // Numeric proximity (e.g., 15 vs 16)
  const qNums = extractNums(tokens);
  const hNums = extractNums(hayTokens);
  if(qNums.length && hNums.length){
    let bestDelta = Infinity;
    for(const qn of qNums){
      for(const hn of hNums){
        const d = Math.abs(hn - qn);
        if(d < bestDelta) bestDelta = d;
      }
    }
    if(bestDelta === 0) score += 25;
    else if(bestDelta <= 1) score += 10;
    else if(bestDelta <= 2) score += 5;
    else score -= bestDelta; // small penalty for far generations
  }

  // Slight length penalty to prefer tighter matches
  score -= Math.max(0, hayTokens.length - tokens.length) * 0.25;
  return score;
}

// ==== PREP ====
let PREPARED = null;
function prepareIndex() {
  if (PREPARED) return;
  PREPARED = {};
  Object.entries(DATASETS).forEach(([sheet, rows]) => {
    PREPARED[sheet] = rows.map(r => ({
      device: r.device,
      price: r.price,
      search: buildSearchBlob((r.display || r.device), sheet)
    }));
  });
}

// ==== UI STATE ====
let activeSheet = Object.keys(DATASETS)[0] || null;
const sheetSelect = document.getElementById('sheetSelect');
const sectionsEl = document.getElementById('sections');
const searchEl = document.getElementById('search');

function fmtPrice(n) {
  if (n == null || isNaN(n)) return '';
  const r = Math.round(Number(n) / 10) * 10; // nearest $10
  return String(r);
}
function hashSHA256(str) {
  const enc = new TextEncoder().encode(str);
  return crypto.subtle.digest('SHA-256', enc).then(buf => {
    return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2,'0')).join('');
  });
}
function discountFor(sheet, price) {
  const cfg = getEngineConfig();
  const page = (cfg.perSheet && cfg.perSheet[sheet]) ? cfg.perSheet[sheet] : {};
  for (const [key, lo, hi] of PRICE_BUCKETS) {
    if (price >= lo && price <= hi) {
      const v = page[key] ?? cfg.defaults[key] ?? 0;
      return Number(v) || 0;
    }
  }
  return 0;
}
function applyDiscount(p, pct) { return p * (1 - pct/100); }

function render() {
  prepareIndex();

  // Pages dropdown
  sheetSelect.innerHTML = '';
  Object.keys(DATASETS).forEach((name) => {
    const opt = document.createElement('option');
    opt.value = name;
    opt.textContent = name;
    if (!activeSheet) activeSheet = name;
    if (name === activeSheet) opt.selected = true;
    sheetSelect.appendChild(opt);
  });

  // Sections
  sectionsEl.innerHTML = '';
  Object.entries(PREPARED).forEach(([name, rows]) => {
    const sec = document.createElement('section');
    sec.className = 'section' + (name === activeSheet ? ' active' : '');

    const list = document.createElement('div');
    list.className = 'list';

    const q = searchEl.value || '';
    const matches = [];
    rows.forEach((r, idx) => {
      const dev = String(r.device || r.display);
      const base = Number(r.price);
      if (!dev || isNaN(base)) return;
      if (!matchesQuery(r, q)) return;

      const offPct = discountFor(name, base);
      const finalPrice = applyDiscount(base, offPct);
      const sc = q ? rankScore(r, q) : 0;
      matches.append ? matches.append({r, idx, finalPrice, offPct, base, dev, sc})
                     : matches.push({r, idx, finalPrice, offPct, base, dev, sc});
    });

    // Sort by score desc, then by original order
    matches.sort((a,b) => (b.sc - a.sc) || (a.idx - b.idx));

    matches.forEach(m => {
      const item = document.createElement('div');
      item.className = 'item';
      const nameEl = document.createElement('div');
      nameEl.className = 'name';
      nameEl.textContent = m.dev;

      const priceEl = document.createElement('div');
      priceEl.className = 'price';
      priceEl.textContent = fmtPrice(m.finalPrice);

      const right = document.createElement('div');
      right.style.textAlign = 'right';
      right.appendChild(priceEl);

      item.appendChild(nameEl);
      item.appendChild(right);
      list.appendChild(item);
    });

    sec.appendChild(list);
    sectionsEl.appendChild(sec);
  });
}

searchEl.addEventListener('input', render);
sheetSelect.addEventListener('change', (e) => { activeSheet = e.target.value; render(); });

// ==== Engine Room: header title acts as the button ====
const overlay = document.getElementById('engineOverlay');
const closeBtn = document.getElementById('closeEngine');
const pinClose = document.getElementById('pinClose');
const pinInput = document.getElementById('pinInput');
const pinCheck = document.getElementById('pinCheck');
const engineBody = document.getElementById('engineBody');
const defaultsRow = document.getElementById('defaultsRow');
const sheetsBlock = document.getElementById('sheetsBlock');
const saveBtn = document.getElementById('saveEngine');
const resetBtn = document.getElementById('resetEngine');
const exportBtn = document.getElementById('exportConfig');
const titleBtn = document.getElementById('titleBtn');
const themeSelect = document.getElementById('themeSelect');
const themeGrid = document.getElementById('themeGrid');
const cycleThemeBtn = document.getElementById('cycleTheme');

function openEngine() { overlay.style.display = 'flex'; pinInput.value = ''; engineBody.style.display = 'none'; }
function closeEngine() { overlay.style.display = 'none'; }

document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && (e.key === 'e' || e.key === 'E')) { e.preventDefault(); openEngine(); }
  if (e.altKey && (e.key === 't' || e.key === 'T')) { e.preventDefault(); cycleTheme(); }
});
titleBtn.addEventListener('click', openEngine);
titleBtn.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openEngine(); }
});

closeBtn.addEventListener('click', closeEngine);
pinClose.addEventListener('click', closeEngine);

function hashSHA256_inline(str){
  const enc = new TextEncoder().encode(str);
  return crypto.subtle.digest('SHA-256', enc).then(buf => {
    return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
  });
}

pinCheck.addEventListener('click', async () => {
  const h = await hashSHA256_inline(pinInput.value || '');
  if (h === PIN_SHA256) {
    buildEngineUI();
    engineBody.style.display = 'block';
  } else {
    alert('Wrong PIN');
  }
});

function makeThemeCard(name){
  const card = document.createElement('div');
  card.className = 'theme-card';
  card.dataset.theme = name;
  const sw = document.createElement('div');
  sw.className = 'theme-swatch';
  const lab = document.createElement('div');
  lab.className = 'lab';
  const text = document.createElement('span');
  text.textContent = name.replace(/-/g,' ');
  const choose = document.createElement('button');
  choose.textContent = 'Use';
  choose.addEventListener('click', () => { applyTheme(name); syncThemeUI(); });
  lab.appendChild(text); lab.appendChild(choose);
  card.appendChild(sw); card.appendChild(lab);
  card.addEventListener('click', () => { applyTheme(name); syncThemeUI(); });
  return card;
}
function syncThemeUI(){
  const cur = document.body.getAttribute('data-theme') || 'midnight-glass';
  if (themeSelect){
    themeSelect.value = cur;
  }
  if (themeGrid){
    themeGrid.querySelectorAll('.theme-card').forEach(el => {
      el.classList.toggle('active', el.dataset.theme === cur);
    });
  }
}
function buildThemeUI(){
  if (themeSelect){
    themeSelect.innerHTML = '';
    THEMES.forEach(t => {
      const opt = document.createElement('option');
      opt.value = t; opt.textContent = t.replace(/-/g,' ');
      themeSelect.appendChild(opt);
    });
    themeSelect.addEventListener('change', (e) => { applyTheme(e.target.value); syncThemeUI(); });
  }
  if (themeGrid){
    themeGrid.innerHTML = '';
    THEMES.forEach(t => themeGrid.appendChild(makeThemeCard(t)));
  }
  if (cycleThemeBtn){
    cycleThemeBtn.addEventListener('click', () => { cycleTheme(); });
  }
  syncThemeUI();
}

function buildEngineUI() {
  const cfg = getEngineConfig();

  // Theme UI
  buildThemeUI();

  // Defaults row
  defaultsRow.innerHTML = '';
  for (const [label] of PRICE_BUCKETS) {
    const wrap = document.createElement('div');
    const lab = document.createElement('label');
    lab.textContent = label + ' (%)';
    const inp = document.createElement('input');
    inp.type = 'number'; inp.min = '0'; inp.max = '100'; inp.step = '1';
    inp.value = cfg.defaults[label] ?? DEFAULT_RULES[label] ?? 0;
    inp.dataset.scope = 'defaults';
    inp.dataset.key = label;
    wrap.appendChild(lab); wrap.appendChild(inp);
    defaultsRow.appendChild(wrap);
  }

  // Per-sheet blocks
  sheetsBlock.innerHTML = '';
  Object.keys(DATASETS).forEach(sheetName => {
    const block = document.createElement('div');
    block.className = 'sheet-block';
    const title = document.createElement('div');
    title.style.marginBottom = '6px';
    title.innerHTML = '<b>' + sheetName + '</b>';
    block.appendChild(title);
    const row = document.createElement('div');
    row.className = 'row';
    PRICE_BUCKETS.forEach(([label]) => {
      const wrap = document.createElement('div');
      const lab = document.createElement('label');
      lab.textContent = label + ' (%)';
      const inp = document.createElement('input');
      inp.type = 'number'; inp.min = '0'; inp.max = '100'; inp.step = '1';
      const v = (cfg.perSheet?.[sheetName]?.[label]);
      inp.value = (v === undefined || v === null || v === '') ? '' : v;
      inp.placeholder = String(cfg.defaults[label] ?? DEFAULT_RULES[label] ?? 0);
      inp.dataset.scope = 'sheet';
      inp.dataset.sheet = sheetName;
      inp.dataset.key = label;
      wrap.appendChild(lab); wrap.appendChild(inp);
      row.appendChild(wrap);
    });
    block.appendChild(row);
    sheetsBlock.appendChild(block);
  });
}

saveBtn.addEventListener('click', () => {
  const cfg = getEngineConfig();
  const inps = overlay.querySelectorAll('input[type="number"]');
  inps.forEach(inp => {
    const scope = inp.dataset.scope;
    const key = inp.dataset.key;
    const val = inp.value;
    if (scope === 'defaults') {
      cfg.defaults[key] = (val === '' ? DEFAULT_RULES[key] : Number(val));
    } else if (scope === 'sheet') {
      const sheet = inp.dataset.sheet;
      cfg.perSheet[sheet] = cfg.perSheet[sheet] || {};
      cfg.perSheet[sheet][key] = (val === '' ? null : Number(val));
    }
  });
  setEngineConfig(cfg);
  render();
  alert('Saved. Discounts applied.');
});

resetBtn.addEventListener('click', () => {
  if (!confirm('Reset ALL overrides and defaults to initial values?')) return;
  setEngineConfig({ defaults: DEFAULT_RULES, perSheet: {} });
  buildEngineUI();
  render();
});

exportBtn.addEventListener('click', () => {
  const cfg = getEngineConfig();
  downloadConfigFile(cfg);
});

// Boot
loadTheme();
render();
</script>
</body>
</html>